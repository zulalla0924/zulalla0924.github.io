{"content":"{\"__ud_title\":\"how to keep openclaw and frpc on\",\"__ud_tags\":[],\"__ud_update_time\":1770466052693,\"__ud_create_time\":1770466050849,\"__ud_draft\":false,\"type\":\"doc\",\"content\":[{\"type\":\"heading\",\"attrs\":{\"level\":1,\"id\":null},\"content\":[{\"type\":\"text\",\"text\":\"how to keep openclaw and frpc on\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"问题场景\"},\"content\":[{\"type\":\"text\",\"text\":\"问题场景\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"在 Android 设备上运行 frpc（内网穿透客户端）和 OpenClaw 时，面临以下挑战：\"}]},{\"type\":\"orderedList\",\"attrs\":{\"start\":1,\"type\":null},\"content\":[{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"手机重启后服务不自动启动\"},{\"type\":\"hardBreak\"},{\"type\":\"text\",\"text\":\"Android 系统不会自动运行 Termux 中的后台服务\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"进程崩溃后不会重启\"},{\"type\":\"hardBreak\"},{\"type\":\"text\",\"text\":\"frpc 或 OpenClaw 可能因网络波动、内存不足等原因崩溃，需要手动介入\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"无法方便地查看日志\"},{\"type\":\"hardBreak\"},{\"type\":\"text\",\"text\":\"后台运行的进程没有会话管理，调试困难\"}]}]}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"需求\"},\"content\":[{\"type\":\"text\",\"text\":\"需求\"}]},{\"type\":\"bulletList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"✅ 手机开机后 frpc + OpenClaw 自动启动\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"✅ 进程崩溃后自动检测并重启\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"✅ 方便查看运行日志\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"✅ 低资源占用（不频繁检测）\"}]}]}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"方案概述\"},\"content\":[{\"type\":\"text\",\"text\":\"方案概述\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"利用 Termux 生态中的三个工具组合：\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"工具 作用 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"termux:boot\"},{\"type\":\"text\",\"text\":\" 开机时自动执行脚本 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"termux-wake-lock\"},{\"type\":\"text\",\"text\":\" 防止系统休眠杀死进程 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"tmux\"},{\"type\":\"text\",\"text\":\" 会话管理（保持进程运行、方便查看日志） \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"cron\"},{\"type\":\"text\",\"text\":\" 定时任务（每5分钟检测进程存活）\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"架构图\"},\"content\":[{\"type\":\"text\",\"text\":\"架构图\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"┌─────────────────────────────────────────────────────────────┐\\n│                        Android 系统                          │\\n│  ┌─────────────────────────────────────────────────────┐   │\\n│  │                  Termux 环境                         │   │\\n│  │  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐ │   │\\n│  │  │ termux:boot │→ │ frpc-start │→ │ frpc        │ │   │\\n│  │  │ (开机执行)   │→ │ (wake lock) │  │ openclaw    │ │   │\\n│  │  └─────────────┘  └─────────────┘  └──────────────┘ │   │\\n│  │                                                  │     │   │\\n│  │  ┌─────────────┐  ┌────────────────────────────┐  │     │   │\\n│  │  │    cron     │→ │ monitor.sh (每5分钟执行)   │  │     │   │\\n│  │  │ (定时检测)   │  │ 检测进程是否存在 → 重启    │  │     │   │\\n│  │  └─────────────┘  └────────────────────────────┘  │     │   │\\n│  └─────────────────────────────────────────────────────┘   │\\n└─────────────────────────────────────────────────────────────┘\\n\"}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"依赖安装\"},\"content\":[{\"type\":\"text\",\"text\":\"依赖安装\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"# 安装 tmux（会话管理）\\npkg install tmux\\n\\n# 安装 cron（定时任务）\\npkg install crontab\\n\\n# 安装 termux:boot（开机自启）\\npkg install termux-boot\\n\"}]},{\"type\":\"blockquote\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"termux:boot 安装后需要在 Android 设置中授权自启动权限\"}]}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"️-关键经验教训\"},\"content\":[{\"type\":\"text\",\"text\":\"⚠️ 关键经验教训\"}]},{\"type\":\"orderedList\",\"attrs\":{\"start\":1,\"type\":null},\"content\":[{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"termux:boot 只在开机时执行一次\"},{\"type\":\"text\",\"text\":\"，杀进程后不会自动重启\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"boot 脚本不能用环境变量\"},{\"type\":\"text\",\"text\":\"，必须硬编码 token 和 port\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"crond 必须加入 boot 脚本\"},{\"type\":\"text\",\"text\":\"，否则进程监控不生效\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"monitor.sh 用绝对路径\"},{\"type\":\"text\",\"text\":\"，cron 环境下 $PREFIX 不生效\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"frpc 用 exec 启动\"},{\"type\":\"text\",\"text\":\"，确保 wake lock 正确持有，防止休眠被杀死\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"monitor.sh 添加日志\"},{\"type\":\"text\",\"text\":\"，便于追踪重启历史和调试\"}]}]}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"LOG_FILE=$HOME/monitor.log\\nlog() {\\n    echo \\\"[$(date)] $1\\\" >> \\\"$LOG_FILE\\\"\\n}\\n\"}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"脚本内容\"},\"content\":[{\"type\":\"text\",\"text\":\"脚本内容\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"1-OpenClaw-启动脚本-openclaw-runsh\"},\"content\":[{\"type\":\"text\",\"text\":\"1. OpenClaw 启动脚本 (\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"~/openclaw-run.sh\"},{\"type\":\"text\",\"text\":\")\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"负责清理旧进程、重新启动 OpenClaw：\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"#!/data/data/com.termux/files/usr/bin/bash\\n# OpenClaw 启动脚本\\n\\n# 杀掉旧进程\\npkill -9 -f 'openclaw' 2>/dev/null\\ntmux kill-session -t openclaw 2>/dev/null\\n\\n# 等待资源释放\\nsleep 1\\n\\n# 创建新 tmux 会话\\ntmux new -d -s openclaw\\n\\n# 等待会话就绪\\nsleep 1\\n\\n# 发送启动命令到 tmux 会话\\ntmux send-keys -t openclaw \\\"export PATH=$NPM_BIN:\\\\$PATH TMPDIR=\\\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=$TOKEN; openclaw gateway --bind lan --port $PORT --token \\\\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured\\\" C-m\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"2-开机启动脚本-termuxbootservicessh\"},\"content\":[{\"type\":\"text\",\"text\":\"2. 开机启动脚本 (\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"~/.termux/boot/services.sh\"},{\"type\":\"text\",\"text\":\")\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"手机开机时自动启动 crond、frpc 和 OpenClaw：\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"#!/data/data/com.termux/files/usr/bin/bash\\n# termux:boot services - 开机会话启动\\n\\n# 启动 crond（关键）\\ncrond\\n\\n# 启动 frpc（使用独立脚本，包含 wake lock）\\nbash ~/.termux/boot/frpc-start.sh &\\n\\n# 清理旧 OpenClaw 进程后启动\\npkill -9 -f 'openclaw' 2>/dev/null\\ntmux kill-session -t openclaw 2>/dev/null\\nsleep 1\\ntmux new -d -s openclaw\\nsleep 1\\n# 注意：这里必须用硬编码的参数，不能用环境变量\\ntmux send-keys -t openclaw \\\"export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\\\$PATH TMPDIR=\\\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\\\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured\\\" C-m\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"3-frpc-启动脚本-termuxbootfrpc-startsh\"},\"content\":[{\"type\":\"text\",\"text\":\"3. frpc 启动脚本 (\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"~/.termux/boot/frpc-start.sh\"},{\"type\":\"text\",\"text\":\")\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"负责启动 frpc 并持有 wake lock，防止系统休眠导致进程被杀死：\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"#!/data/data/com.termux/files/usr/bin/bash\\ntermux-wake-lock\\n/data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"4-进程监控脚本-monitorsh\"},\"content\":[{\"type\":\"text\",\"text\":\"4. 进程监控脚本 (\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"~/monitor.sh\"},{\"type\":\"text\",\"text\":\")\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"每5分钟检测一次，崩溃则重启：\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"#!/data/data/com.termux/files/usr/bin/bash\\n# 进程监控脚本 - 每5分钟检测并重启崩溃的服务\\n\\nLOG_FILE=$HOME/monitor.log\\nMAX_LOG_LINES=1000  # 日志最大行数\\n\\nlog() {\\n    echo \\\"[$(date '+%Y-%m-%d %H:%M:%S')] $1\\\" >> \\\"$LOG_FILE\\\"\\n}\\n\\ntrim_log() {\\n    # 保留最后 MAX_LOG_LINES 行\\n    local lines=$(wc -l < \\\"$LOG_FILE\\\" 2>/dev/null || echo 0)\\n    if [ \\\"$lines\\\" -gt \\\"$MAX_LOG_LINES\\\" ]; then\\n        tail -n \\\"$MAX_LOG_LINES\\\" \\\"$LOG_FILE\\\" > \\\"$LOG_FILE.tmp\\\"\\n        mv \\\"$LOG_FILE.tmp\\\" \\\"$LOG_FILE\\\"\\n    fi\\n}\\n\\nlog \\\"========== Monitor started ==========\\\"\\n\\n# frpc 检测\\nif ! pgrep -f \\\"frpc\\\" > /dev/null; then\\n    log \\\"frpc 进程不存在，准备重启...\\\"\\n    tmux kill-session -t frpc 2>/dev/null\\n    sleep 1\\n    # 用 exec 确保 wake lock 正确持有\\n    tmux new-session -d -s frpc \\\"exec /data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\\\"\\n    log \\\"frpc 重启命令已发送\\\"\\nelse\\n    log \\\"frpc 运行正常\\\"\\nfi\\n\\n# OpenClaw 检测\\nif ! pgrep -f \\\"openclaw.*gateway\\\" > /dev/null; then\\n    log \\\"OpenClaw 进程不存在，准备重启...\\\"\\n    tmux kill-session -t openclaw 2>/dev/null\\n    sleep 2  # 等待端口释放\\n    bash ~/openclaw-run.sh\\n    log \\\"OpenClaw 重启命令已发送\\\"\\nelse\\n    log \\\"OpenClaw 运行正常\\\"\\nfi\\n\\n# 清理日志\\ntrim_log\\n\\nlog \\\"========== Monitor finished ==========\\\"\\n\"}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"操作步骤\"},\"content\":[{\"type\":\"text\",\"text\":\"操作步骤\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"第一步安装依赖\"},\"content\":[{\"type\":\"text\",\"text\":\"第一步：安装依赖\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"pkg update && pkg install tmux crontab termux-api\\ncrond\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"第二步创建脚本文件\"},\"content\":[{\"type\":\"text\",\"text\":\"第二步：创建脚本文件\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":4,\"id\":\"创建目录\"},\"content\":[{\"type\":\"text\",\"text\":\"创建目录\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"mkdir -p ~/.termux/boot\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":4,\"id\":\"创建-openclaw-runsh\"},\"content\":[{\"type\":\"text\",\"text\":\"创建 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"~/openclaw-run.sh\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"（将下方内容写入文件，\"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"注意：参数必须硬编码\"},{\"type\":\"text\",\"text\":\"）\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"#!/data/data/com.termux/files/usr/bin/bash\\n# OpenClaw 启动脚本 - 硬编码参数\\n\\n# 杀掉旧进程\\npkill -9 -f 'openclaw' 2>/dev/null\\ntmux kill-session -t openclaw 2>/dev/null\\n\\n# 等待资源释放（增加等待时间）\\nsleep 2\\n\\n# 创建新 tmux 会话\\ntmux new -d -s openclaw\\n\\n# 等待会话就绪\\nsleep 1\\n\\n# 发送启动命令（硬编码所有参数）\\ntmux send-keys -t openclaw \\\"export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\\\$PATH TMPDIR=\\\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\\\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured\\\" C-m\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":4,\"id\":\"创建-termuxbootservicessh\"},\"content\":[{\"type\":\"text\",\"text\":\"创建 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"~/.termux/boot/services.sh\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"（将下方内容写入文件，\"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"注意：参数必须硬编码\"},{\"type\":\"text\",\"text\":\"）\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"#!/data/data/com.termux/files/usr/bin/bash\\n# termux:boot services - 开机会话启动\\n\\n# 1. 清理旧会话\\ntmux kill-session -t frpc 2>/dev/null\\ntmux kill-session -t openclaw 2>/dev/null\\nsleep 1\\n\\n# 2. 启动 crond（关键）\\ncrond\\n\\n# 3. 启动 frpc（持有 wake lock）\\ntmux new-session -d -s frpc \\\"exec /data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\\\"\\n\\n# 4. 启动 OpenClaw\\ntmux new -d -s openclaw\\nsleep 1\\ntmux send-keys -t openclaw \\\"export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\\\$PATH TMPDIR=\\\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\\\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured\\\" C-m\\n\\nlog \\\"Services started at $(date)\\\" >> ~/boot.log 2>/dev/null || true\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":4,\"id\":\"创建-termuxbootfrpc-startsh\"},\"content\":[{\"type\":\"text\",\"text\":\"创建 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"~/.termux/boot/frpc-start.sh\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"（将下方内容写入文件，包含 wake lock 防止休眠）\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"#!/data/data/com.termux/files/usr/bin/bash\\ntermux-wake-lock\\n/data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":4,\"id\":\"创建-monitorsh\"},\"content\":[{\"type\":\"text\",\"text\":\"创建 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"~/monitor.sh\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"（将下方内容写入文件，\"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"注意：用 tmux 管理 frpc\"},{\"type\":\"text\",\"text\":\"）\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"#!/data/data/com.termux/files/usr/bin/bash\\n# frpc 检测\\nif ! pgrep -f \\\"frpc\\\" > /dev/null; then\\n    tmux new-session -d -s frpc \\\"frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\\\"\\nfi\\n\\n# OpenClaw 检测\\nif ! pgrep -f \\\"openclaw.*gateway\\\" > /dev/null; then\\n    tmux kill-session -t openclaw 2>/dev/null\\n    bash ~/openclaw-run.sh\\nfi\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"第三步设置权限\"},\"content\":[{\"type\":\"text\",\"text\":\"第三步：设置权限\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"chmod +x ~/.termux/boot/services.sh ~/.termux/boot/frpc-start.sh ~/openclaw-run.sh ~/monitor.sh\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"第四步配置-cron\"},\"content\":[{\"type\":\"text\",\"text\":\"第四步：配置 cron\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"# 编辑 crontab\\ncrontab -e\\n\\n# 添加以下内容（每5分钟检测一次）\\n*/5 * * * * /data/data/com.termux/files/home/monitor.sh\\n\\n# 保存退出后，启动 cron 服务（这一步也可以放到 boot 脚本里自动执行）\\ncrond\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"第五步测试\"},\"content\":[{\"type\":\"text\",\"text\":\"第五步：测试\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"# 手动启动 boot 脚本测试\\nbash ~/.termux/boot/services.sh\\n\\n# 查看 tmux 会话\\ntmux ls\\n\\n# 查看进程是否运行\\nps aux | grep -E \\\"crond|frpc|openclaw\\\" | grep -v grep\\n\\n# 查看 crond 是否运行（验证 boot 脚本是否成功执行）\\nps aux | grep crond | grep -v grep\\n\\n# 手动测试检测脚本\\nbash ~/monitor.sh\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"第六步验证开机自启动\"},\"content\":[{\"type\":\"text\",\"text\":\"第六步：验证开机自启动\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"# 重启手机，验证以下进程是否自动启动：\\n# 1. crond - 进程监控依赖它\\n# 2. frpc - 内网穿透\\n# 3. OpenClaw - 主服务\\n\\nps aux | grep -E \\\"crond|frpc|openclaw\\\" | grep -v grep\\n\"}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"常用命令\"},\"content\":[{\"type\":\"text\",\"text\":\"常用命令\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"操作 命令 查看 tmux 会话 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"tmux ls\"},{\"type\":\"text\",\"text\":\" 查看 frpc 日志 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"tmux attach -t frpc\"},{\"type\":\"text\",\"text\":\"（Ctrl+B 然后 D 退出） 查看 OpenClaw 日志 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"tmux attach -t openclaw\"},{\"type\":\"text\",\"text\":\" 强制退出日志视图 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"Ctrl+B 然后 D\"},{\"type\":\"text\",\"text\":\" 杀掉 tmux 会话 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"tmux kill-session -t frpc/openclaw\"},{\"type\":\"text\",\"text\":\" 手动执行检测 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"bash /data/data/com.termux/files/home/monitor.sh\"},{\"type\":\"text\",\"text\":\" 查看监控日志 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"tail -f ~/monitor.log\"},{\"type\":\"text\",\"text\":\" 查看启动日志 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"tail -f ~/boot.log\"},{\"type\":\"text\",\"text\":\" 查看 cron 日志 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"logcat -s crond\"}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"常见问题\"},\"content\":[{\"type\":\"text\",\"text\":\"常见问题\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"Q1-检测频率会影响电池吗\"},\"content\":[{\"type\":\"text\",\"text\":\"Q1: 检测频率会影响电池吗？\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"不会。\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"pgrep\"},{\"type\":\"text\",\"text\":\" 进程检查是非常轻量的系统调用，比手机待机功耗低几个数量级。每5分钟一次完全可接受。\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"Q2-为什么用-tmux-而不是-nohup\"},\"content\":[{\"type\":\"text\",\"text\":\"Q2: 为什么用 tmux 而不是 nohup？\"}]},{\"type\":\"bulletList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"tmux 可以方便地查看实时日志\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"tmux 保持会话不中断\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"可以随时手动连接查看状态\"}]}]}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"Q3-termuxboot-没生效\"},\"content\":[{\"type\":\"text\",\"text\":\"Q3: termux:boot 没生效？\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"检查： 1. Android 设置中允许 Termux 自启动 2. 脚本权限正确（\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"chmod +x\"},{\"type\":\"text\",\"text\":\"） 3. \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"boot 脚本里用了硬编码的路径和参数？\"},{\"type\":\"text\",\"text\":\" 4. 重启手机测试，不只是重启 Termux app\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"Q4-手机重启后-frpcOpenClaw-没启动\"},\"content\":[{\"type\":\"text\",\"text\":\"Q4: 手机重启后 frpc/OpenClaw 没启动？\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"可能原因： 1. \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"crond 没在 boot 脚本里启动\"},{\"type\":\"text\",\"text\":\" → monitor.sh 不会运行 2. \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"boot 脚本用了环境变量\"},{\"type\":\"text\",\"text\":\" → 开机时 $TOKEN、$PORT 为空 3. \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"boot 脚本语法错误\"},{\"type\":\"text\",\"text\":\" → 检查日志：\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"logcat -s termux:boot\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"Q5-进程崩溃后没自动重启\"},\"content\":[{\"type\":\"text\",\"text\":\"Q5: 进程崩溃后没自动重启？\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"可能原因： 1. \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"crond 没运行\"},{\"type\":\"text\",\"text\":\" → \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"ps aux | grep crond\"},{\"type\":\"text\",\"text\":\" 2. \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"monitor.sh 路径错误\"},{\"type\":\"text\",\"text\":\" → crontab 里用绝对路径 \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"/data/data/com.termux/files/home/monitor.sh\"},{\"type\":\"text\",\"text\":\" 3. \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"monitor.sh 里用了 $PREFIX\"},{\"type\":\"text\",\"text\":\" → 改成绝对路径\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"Q6-如何调整检测频率\"},\"content\":[{\"type\":\"text\",\"text\":\"Q6: 如何调整检测频率？\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"编辑 crontab：\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"crontab -e\\n\"}]},{\"type\":\"bulletList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"每1分钟：\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"* * * * * /data/data/com.termux/files/home/monitor.sh\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"每5分钟：\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"*/5 * * * * /data/data/com.termux/files/home/monitor.sh\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"每10分钟：\"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"*/10 * * * * /data/data/com.termux/files/home/monitor.sh\"}]}]}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"Q7-boot-脚本执行了但进程没起来\"},\"content\":[{\"type\":\"text\",\"text\":\"Q7: boot 脚本执行了但进程没起来？\"}]},{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"调试方法：\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"# 手动执行 boot 脚本看报错\\nbash -x ~/.termux/boot/services.sh\\n\\n# 查看 termux:boot 日志\\nlogcat -s termux:boot\\n\\n# 检查环境变量是否存在\\necho $TOKEN $PORT $PREFIX\\n\"}]},{\"type\":\"heading\",\"attrs\":{\"level\":3,\"id\":\"Q8-如何查看日志\"},\"content\":[{\"type\":\"text\",\"text\":\"Q8: 如何查看日志？\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"# 查看监控日志（进程重启记录）\\ntail -f ~/monitor.log\\n\\n# 查看启动日志\\ntail -f ~/boot.log\\n\\n# 查看 tmux 会话日志\\ntmux attach -t openclaw\\ntmux attach -t frpc\\n\"}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"效果\"},\"content\":[{\"type\":\"text\",\"text\":\"效果\"}]},{\"type\":\"bulletList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"手机重启\"},{\"type\":\"text\",\"text\":\" → crond + frpc + OpenClaw \"},{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"全部自动启动\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"进程崩溃\"},{\"type\":\"text\",\"text\":\" → 5分钟内自动检测并重启\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"bold\"}],\"text\":\"随时查看日志\"},{\"type\":\"text\",\"text\":\" → \"},{\"type\":\"text\",\"marks\":[{\"type\":\"code\"}],\"text\":\"tmux attach -t openclaw\"}]}]}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"完整启动链路手机开机后\"},\"content\":[{\"type\":\"text\",\"text\":\"完整启动链路（手机开机后）\"}]},{\"type\":\"codeBlock\",\"attrs\":{\"language\":null},\"content\":[{\"type\":\"text\",\"text\":\"手机开机\\n    ↓\\ntermux:boot 自动触发\\n    ↓\\nservices.sh 执行：\\n  1. crond（关键！进程监控依赖它）\\n  2. frpc-start.sh（持有 wake lock）\\n  3. OpenClaw（主服务）\\n    ↓\\nfrpc 持有 termux-wake-lock，防止系统休眠\\n    ↓\\ncrond 每5分钟运行 monitor.sh\\n    ↓\\n检测到进程挂了 → 自动重启\\n\"}]},{\"type\":\"horizontalRule\"},{\"type\":\"heading\",\"attrs\":{\"level\":2,\"id\":\"参考资源\"},\"content\":[{\"type\":\"text\",\"text\":\"参考资源\"}]},{\"type\":\"bulletList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"link\",\"attrs\":{\"href\":\"https://wiki.termux.com/wiki/Termux:Boot\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer nofollow\",\"class\":null}}],\"text\":\"Termux Wiki - Boot\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"link\",\"attrs\":{\"href\":\"https://wiki.termux.com/wiki/Cron\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer nofollow\",\"class\":null}}],\"text\":\"Termux Wiki - Cron\"}]}]},{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"marks\":[{\"type\":\"link\",\"attrs\":{\"href\":\"https://tmuxcheatsheet.com/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer nofollow\",\"class\":null}}],\"text\":\"Tmux 常用命令\"}]}]}]}]}","title":"how to keep openclaw and frpc on","tags":[],"updateTime":1770466052693,"createTime":1770466050849,"draft":false,"intro":"在 Android 设备上运行 frpc（内网穿透客户端）和 OpenClaw 时，面临以下挑战：","html":"<h1 level=\"1\" id=\"how-to-keep-openclaw-and-frpc-on\">how to keep openclaw and frpc on</h1><h3 level=\"3\" id=\"问题场景\">问题场景</h3><p>在 Android 设备上运行 frpc（内网穿透客户端）和 OpenClaw 时，面临以下挑战：</p><ol><li><p><strong>手机重启后服务不自动启动</strong><br>Android 系统不会自动运行 Termux 中的后台服务</p></li><li><p><strong>进程崩溃后不会重启</strong><br>frpc 或 OpenClaw 可能因网络波动、内存不足等原因崩溃，需要手动介入</p></li><li><p><strong>无法方便地查看日志</strong><br>后台运行的进程没有会话管理，调试困难</p></li></ol><h3 level=\"3\" id=\"需求\">需求</h3><ul><li><p>✅ 手机开机后 frpc + OpenClaw 自动启动</p></li><li><p>✅ 进程崩溃后自动检测并重启</p></li><li><p>✅ 方便查看运行日志</p></li><li><p>✅ 低资源占用（不频繁检测）</p></li></ul><hr><h2 level=\"2\" id=\"方案概述\">方案概述</h2><p>利用 Termux 生态中的三个工具组合：</p><p>工具 作用 <strong>termux:boot</strong> 开机时自动执行脚本 <strong>termux-wake-lock</strong> 防止系统休眠杀死进程 <strong>tmux</strong> 会话管理（保持进程运行、方便查看日志） <strong>cron</strong> 定时任务（每5分钟检测进程存活）</p><h3 level=\"3\" id=\"架构图\">架构图</h3><div class=\"llt-code readonly\"><div class=\"language\">csharp</div><div class=\"wrapper\"><pre><code>┌─────────────────────────────────────────────────────────────┐\n│                        Android 系统                          │\n│  ┌─────────────────────────────────────────────────────┐   │\n│  │                  Termux 环境                         │   │\n│  │  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐ │   │\n│  │  │ termux:boot │→ │ frpc-start │→ │ frpc        │ │   │\n│  │  │ (开机执行)   │→ │ (wake <span class=\"hljs-keyword\" class=\"hljs-keyword\">lock</span>) │  │ openclaw    │ │   │\n│  │  └─────────────┘  └─────────────┘  └──────────────┘ │   │\n│  │                                                  │     │   │\n│  │  ┌─────────────┐  ┌────────────────────────────┐  │     │   │\n│  │  │    cron     │→ │ monitor.sh (每<span class=\"hljs-number\" class=\"hljs-number\">5</span>分钟执行)   │  │     │   │\n│  │  │ (定时检测)   │  │ 检测进程是否存在 → 重启    │  │     │   │\n│  │  └─────────────┘  └────────────────────────────┘  │     │   │\n│  └─────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────┘\n</code></pre></div></div><hr><h2 level=\"2\" id=\"依赖安装\">依赖安装</h2><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-comment\" class=\"hljs-comment\"># 安装 tmux（会话管理）</span>\npkg install tmux\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 安装 cron（定时任务）</span>\npkg install crontab\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 安装 termux:boot（开机自启）</span>\npkg install termux-boot\n</code></pre></div></div><blockquote><p><strong>termux:boot 安装后需要在 Android 设置中授权自启动权限</strong></p></blockquote><hr><h2 level=\"2\" id=\"️-关键经验教训\">⚠️ 关键经验教训</h2><ol><li><p><strong>termux:boot 只在开机时执行一次</strong>，杀进程后不会自动重启</p></li><li><p><strong>boot 脚本不能用环境变量</strong>，必须硬编码 token 和 port</p></li><li><p><strong>crond 必须加入 boot 脚本</strong>，否则进程监控不生效</p></li><li><p><strong>monitor.sh 用绝对路径</strong>，cron 环境下 $PREFIX 不生效</p></li><li><p><strong>frpc 用 exec 启动</strong>，确保 wake lock 正确持有，防止休眠被杀死</p></li><li><p><strong>monitor.sh 添加日志</strong>，便于追踪重启历史和调试</p></li></ol><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code>LOG_FILE=<span class=\"hljs-variable\" class=\"hljs-variable\">$HOME</span>/monitor.log\n<span class=\"hljs-function\" class=\"hljs-function\"><span class=\"hljs-title\" class=\"hljs-title\">log</span></span>() {\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;[<span class=\"hljs-subst\" class=\"hljs-subst\">$(date)</span>] <span class=\"hljs-variable\" class=\"hljs-variable\">$1</span>&quot;</span> &gt;&gt; <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$LOG_FILE</span>&quot;</span>\n}\n</code></pre></div></div><hr><h2 level=\"2\" id=\"脚本内容\">脚本内容</h2><h3 level=\"3\" id=\"1-OpenClaw-启动脚本-openclaw-runsh\">1. OpenClaw 启动脚本 (<code>~/openclaw-run.sh</code>)</h3><p>负责清理旧进程、重新启动 OpenClaw：</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-meta\" class=\"hljs-meta\">#!/data/data/com.termux/files/usr/bin/bash</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># OpenClaw 启动脚本</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 杀掉旧进程</span>\npkill -9 -f <span class=\"hljs-string\" class=\"hljs-string\">&apos;openclaw&apos;</span> 2&gt;/dev/null\ntmux kill-session -t openclaw 2&gt;/dev/null\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 等待资源释放</span>\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 1\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 创建新 tmux 会话</span>\ntmux new -d -s openclaw\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 等待会话就绪</span>\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 1\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 发送启动命令到 tmux 会话</span>\ntmux send-keys -t openclaw <span class=\"hljs-string\" class=\"hljs-string\">&quot;export PATH=<span class=\"hljs-variable\" class=\"hljs-variable\">$NPM_BIN</span>:\\$PATH TMPDIR=\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=<span class=\"hljs-variable\" class=\"hljs-variable\">$TOKEN</span>; openclaw gateway --bind lan --port <span class=\"hljs-variable\" class=\"hljs-variable\">$PORT</span> --token \\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured&quot;</span> C-m\n</code></pre></div></div><h3 level=\"3\" id=\"2-开机启动脚本-termuxbootservicessh\">2. 开机启动脚本 (<code>~/.termux/boot/services.sh</code>)</h3><p>手机开机时自动启动 crond、frpc 和 OpenClaw：</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-meta\" class=\"hljs-meta\">#!/data/data/com.termux/files/usr/bin/bash</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># termux:boot services - 开机会话启动</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 启动 crond（关键）</span>\ncrond\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 启动 frpc（使用独立脚本，包含 wake lock）</span>\nbash ~/.termux/boot/frpc-start.sh &amp;\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 清理旧 OpenClaw 进程后启动</span>\npkill -9 -f <span class=\"hljs-string\" class=\"hljs-string\">&apos;openclaw&apos;</span> 2&gt;/dev/null\ntmux kill-session -t openclaw 2&gt;/dev/null\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 1\ntmux new -d -s openclaw\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 1\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 注意：这里必须用硬编码的参数，不能用环境变量</span>\ntmux send-keys -t openclaw <span class=\"hljs-string\" class=\"hljs-string\">&quot;export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\$PATH TMPDIR=\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured&quot;</span> C-m\n</code></pre></div></div><h3 level=\"3\" id=\"3-frpc-启动脚本-termuxbootfrpc-startsh\">3. frpc 启动脚本 (<code>~/.termux/boot/frpc-start.sh</code>)</h3><p>负责启动 frpc 并持有 wake lock，防止系统休眠导致进程被杀死：</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-meta\" class=\"hljs-meta\">#!/data/data/com.termux/files/usr/bin/bash</span>\ntermux-wake-lock\n/data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\n</code></pre></div></div><h3 level=\"3\" id=\"4-进程监控脚本-monitorsh\">4. 进程监控脚本 (<code>~/monitor.sh</code>)</h3><p>每5分钟检测一次，崩溃则重启：</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-meta\" class=\"hljs-meta\">#!/data/data/com.termux/files/usr/bin/bash</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 进程监控脚本 - 每5分钟检测并重启崩溃的服务</span>\n\nLOG_FILE=<span class=\"hljs-variable\" class=\"hljs-variable\">$HOME</span>/monitor.log\nMAX_LOG_LINES=1000  <span class=\"hljs-comment\" class=\"hljs-comment\"># 日志最大行数</span>\n\n<span class=\"hljs-function\" class=\"hljs-function\"><span class=\"hljs-title\" class=\"hljs-title\">log</span></span>() {\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;[<span class=\"hljs-subst\" class=\"hljs-subst\">$(date &apos;+%Y-%m-%d %H:%M:%S&apos;)</span>] <span class=\"hljs-variable\" class=\"hljs-variable\">$1</span>&quot;</span> &gt;&gt; <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$LOG_FILE</span>&quot;</span>\n}\n\n<span class=\"hljs-function\" class=\"hljs-function\"><span class=\"hljs-title\" class=\"hljs-title\">trim_log</span></span>() {\n    <span class=\"hljs-comment\" class=\"hljs-comment\"># 保留最后 MAX_LOG_LINES 行</span>\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">local</span> lines=$(<span class=\"hljs-built_in\" class=\"hljs-built_in\">wc</span> -l &lt; <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$LOG_FILE</span>&quot;</span> 2&gt;/dev/null || <span class=\"hljs-built_in\" class=\"hljs-built_in\">echo</span> 0)\n    <span class=\"hljs-keyword\" class=\"hljs-keyword\">if</span> [ <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$lines</span>&quot;</span> -gt <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$MAX_LOG_LINES</span>&quot;</span> ]; <span class=\"hljs-keyword\" class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\" class=\"hljs-built_in\">tail</span> -n <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$MAX_LOG_LINES</span>&quot;</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$LOG_FILE</span>&quot;</span> &gt; <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$LOG_FILE</span>.tmp&quot;</span>\n        <span class=\"hljs-built_in\" class=\"hljs-built_in\">mv</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$LOG_FILE</span>.tmp&quot;</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;<span class=\"hljs-variable\" class=\"hljs-variable\">$LOG_FILE</span>&quot;</span>\n    <span class=\"hljs-keyword\" class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;========== Monitor started ==========&quot;</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># frpc 检测</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">if</span> ! pgrep -f <span class=\"hljs-string\" class=\"hljs-string\">&quot;frpc&quot;</span> &gt; /dev/null; <span class=\"hljs-keyword\" class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;frpc 进程不存在，准备重启...&quot;</span>\n    tmux kill-session -t frpc 2&gt;/dev/null\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 1\n    <span class=\"hljs-comment\" class=\"hljs-comment\"># 用 exec 确保 wake lock 正确持有</span>\n    tmux new-session -d -s frpc <span class=\"hljs-string\" class=\"hljs-string\">&quot;exec /data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini&quot;</span>\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;frpc 重启命令已发送&quot;</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;frpc 运行正常&quot;</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># OpenClaw 检测</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">if</span> ! pgrep -f <span class=\"hljs-string\" class=\"hljs-string\">&quot;openclaw.*gateway&quot;</span> &gt; /dev/null; <span class=\"hljs-keyword\" class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;OpenClaw 进程不存在，准备重启...&quot;</span>\n    tmux kill-session -t openclaw 2&gt;/dev/null\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 2  <span class=\"hljs-comment\" class=\"hljs-comment\"># 等待端口释放</span>\n    bash ~/openclaw-run.sh\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;OpenClaw 重启命令已发送&quot;</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;OpenClaw 运行正常&quot;</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 清理日志</span>\ntrim_log\n\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;========== Monitor finished ==========&quot;</span>\n</code></pre></div></div><hr><h2 level=\"2\" id=\"操作步骤\">操作步骤</h2><h3 level=\"3\" id=\"第一步安装依赖\">第一步：安装依赖</h3><div class=\"llt-code readonly\"><div class=\"language\">sql</div><div class=\"wrapper\"><pre><code>pkg <span class=\"hljs-keyword\" class=\"hljs-keyword\">update</span> <span class=\"hljs-operator\" class=\"hljs-operator\">&amp;&amp;</span> pkg install tmux crontab termux<span class=\"hljs-operator\" class=\"hljs-operator\">-</span>api\ncrond\n</code></pre></div></div><h3 level=\"3\" id=\"第二步创建脚本文件\">第二步：创建脚本文件</h3><h4 level=\"4\" id=\"创建目录\">创建目录</h4><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-built_in\" class=\"hljs-built_in\">mkdir</span> -p ~/.termux/boot\n</code></pre></div></div><h4 level=\"4\" id=\"创建-openclaw-runsh\">创建 <code>~/openclaw-run.sh</code></h4><p>（将下方内容写入文件，<strong>注意：参数必须硬编码</strong>）</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-meta\" class=\"hljs-meta\">#!/data/data/com.termux/files/usr/bin/bash</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># OpenClaw 启动脚本 - 硬编码参数</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 杀掉旧进程</span>\npkill -9 -f <span class=\"hljs-string\" class=\"hljs-string\">&apos;openclaw&apos;</span> 2&gt;/dev/null\ntmux kill-session -t openclaw 2&gt;/dev/null\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 等待资源释放（增加等待时间）</span>\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 2\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 创建新 tmux 会话</span>\ntmux new -d -s openclaw\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 等待会话就绪</span>\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 1\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 发送启动命令（硬编码所有参数）</span>\ntmux send-keys -t openclaw <span class=\"hljs-string\" class=\"hljs-string\">&quot;export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\$PATH TMPDIR=\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured&quot;</span> C-m\n</code></pre></div></div><h4 level=\"4\" id=\"创建-termuxbootservicessh\">创建 <code>~/.termux/boot/services.sh</code></h4><p>（将下方内容写入文件，<strong>注意：参数必须硬编码</strong>）</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-meta\" class=\"hljs-meta\">#!/data/data/com.termux/files/usr/bin/bash</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># termux:boot services - 开机会话启动</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 1. 清理旧会话</span>\ntmux kill-session -t frpc 2&gt;/dev/null\ntmux kill-session -t openclaw 2&gt;/dev/null\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 1\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 2. 启动 crond（关键）</span>\ncrond\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 3. 启动 frpc（持有 wake lock）</span>\ntmux new-session -d -s frpc <span class=\"hljs-string\" class=\"hljs-string\">&quot;exec /data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini&quot;</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 4. 启动 OpenClaw</span>\ntmux new -d -s openclaw\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">sleep</span> 1\ntmux send-keys -t openclaw <span class=\"hljs-string\" class=\"hljs-string\">&quot;export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\$PATH TMPDIR=\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured&quot;</span> C-m\n\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">log</span> <span class=\"hljs-string\" class=\"hljs-string\">&quot;Services started at <span class=\"hljs-subst\" class=\"hljs-subst\">$(date)</span>&quot;</span> &gt;&gt; ~/boot.log 2&gt;/dev/null || <span class=\"hljs-literal\" class=\"hljs-literal\">true</span>\n</code></pre></div></div><h4 level=\"4\" id=\"创建-termuxbootfrpc-startsh\">创建 <code>~/.termux/boot/frpc-start.sh</code></h4><p>（将下方内容写入文件，包含 wake lock 防止休眠）</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-meta\" class=\"hljs-meta\">#!/data/data/com.termux/files/usr/bin/bash</span>\ntermux-wake-lock\n/data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\n</code></pre></div></div><h4 level=\"4\" id=\"创建-monitorsh\">创建 <code>~/monitor.sh</code></h4><p>（将下方内容写入文件，<strong>注意：用 tmux 管理 frpc</strong>）</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-meta\" class=\"hljs-meta\">#!/data/data/com.termux/files/usr/bin/bash</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># frpc 检测</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">if</span> ! pgrep -f <span class=\"hljs-string\" class=\"hljs-string\">&quot;frpc&quot;</span> &gt; /dev/null; <span class=\"hljs-keyword\" class=\"hljs-keyword\">then</span>\n    tmux new-session -d -s frpc <span class=\"hljs-string\" class=\"hljs-string\">&quot;frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini&quot;</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># OpenClaw 检测</span>\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">if</span> ! pgrep -f <span class=\"hljs-string\" class=\"hljs-string\">&quot;openclaw.*gateway&quot;</span> &gt; /dev/null; <span class=\"hljs-keyword\" class=\"hljs-keyword\">then</span>\n    tmux kill-session -t openclaw 2&gt;/dev/null\n    bash ~/openclaw-run.sh\n<span class=\"hljs-keyword\" class=\"hljs-keyword\">fi</span>\n</code></pre></div></div><h3 level=\"3\" id=\"第三步设置权限\">第三步：设置权限</h3><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-built_in\" class=\"hljs-built_in\">chmod</span> +x ~/.termux/boot/services.sh ~/.termux/boot/frpc-start.sh ~/openclaw-run.sh ~/monitor.sh\n</code></pre></div></div><h3 level=\"3\" id=\"第四步配置-cron\">第四步：配置 cron</h3><div class=\"llt-code readonly\"><div class=\"language\">ruby</div><div class=\"wrapper\"><pre><code><span class=\"hljs-comment\" class=\"hljs-comment\"># 编辑 crontab</span>\ncrontab -e\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 添加以下内容（每5分钟检测一次）</span>\n*<span class=\"hljs-regexp\" class=\"hljs-regexp\">/5 * * * * /data</span><span class=\"hljs-regexp\" class=\"hljs-regexp\">/data/com</span>.termux/files/home/monitor.sh\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 保存退出后，启动 cron 服务（这一步也可以放到 boot 脚本里自动执行）</span>\ncrond\n</code></pre></div></div><h3 level=\"3\" id=\"第五步测试\">第五步：测试</h3><div class=\"llt-code readonly\"><div class=\"language\">perl</div><div class=\"wrapper\"><pre><code><span class=\"hljs-comment\" class=\"hljs-comment\"># 手动启动 boot 脚本测试</span>\nbash ~<span class=\"hljs-regexp\" class=\"hljs-regexp\">/.termux/</span>boot/services.sh\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 查看 tmux 会话</span>\ntmux ls\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 查看进程是否运行</span>\nps aux | <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span> -E <span class=\"hljs-string\" class=\"hljs-string\">&quot;crond|frpc|openclaw&quot;</span> | <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span> -v <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 查看 crond 是否运行（验证 boot 脚本是否成功执行）</span>\nps aux | <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span> crond | <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span> -v <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span>\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 手动测试检测脚本</span>\nbash ~/monitor.sh\n</code></pre></div></div><h3 level=\"3\" id=\"第六步验证开机自启动\">第六步：验证开机自启动</h3><div class=\"llt-code readonly\"><div class=\"language\">perl</div><div class=\"wrapper\"><pre><code><span class=\"hljs-comment\" class=\"hljs-comment\"># 重启手机，验证以下进程是否自动启动：</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 1. crond - 进程监控依赖它</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 2. frpc - 内网穿透</span>\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 3. OpenClaw - 主服务</span>\n\nps aux | <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span> -E <span class=\"hljs-string\" class=\"hljs-string\">&quot;crond|frpc|openclaw&quot;</span> | <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span> -v <span class=\"hljs-keyword\" class=\"hljs-keyword\">grep</span>\n</code></pre></div></div><hr><h2 level=\"2\" id=\"常用命令\">常用命令</h2><p>操作 命令 查看 tmux 会话 <code>tmux ls</code> 查看 frpc 日志 <code>tmux attach -t frpc</code>（Ctrl+B 然后 D 退出） 查看 OpenClaw 日志 <code>tmux attach -t openclaw</code> 强制退出日志视图 <code>Ctrl+B 然后 D</code> 杀掉 tmux 会话 <code>tmux kill-session -t frpc/openclaw</code> 手动执行检测 <code>bash /data/data/com.termux/files/home/monitor.sh</code> 查看监控日志 <code>tail -f ~/monitor.log</code> 查看启动日志 <code>tail -f ~/boot.log</code> 查看 cron 日志 <code>logcat -s crond</code></p><hr><h2 level=\"2\" id=\"常见问题\">常见问题</h2><h3 level=\"3\" id=\"Q1-检测频率会影响电池吗\">Q1: 检测频率会影响电池吗？</h3><p>不会。<code>pgrep</code> 进程检查是非常轻量的系统调用，比手机待机功耗低几个数量级。每5分钟一次完全可接受。</p><h3 level=\"3\" id=\"Q2-为什么用-tmux-而不是-nohup\">Q2: 为什么用 tmux 而不是 nohup？</h3><ul><li><p>tmux 可以方便地查看实时日志</p></li><li><p>tmux 保持会话不中断</p></li><li><p>可以随时手动连接查看状态</p></li></ul><h3 level=\"3\" id=\"Q3-termuxboot-没生效\">Q3: termux:boot 没生效？</h3><p>检查： 1. Android 设置中允许 Termux 自启动 2. 脚本权限正确（<code>chmod +x</code>） 3. <strong>boot 脚本里用了硬编码的路径和参数？</strong> 4. 重启手机测试，不只是重启 Termux app</p><h3 level=\"3\" id=\"Q4-手机重启后-frpcOpenClaw-没启动\">Q4: 手机重启后 frpc/OpenClaw 没启动？</h3><p>可能原因： 1. <strong>crond 没在 boot 脚本里启动</strong> → monitor.sh 不会运行 2. <strong>boot 脚本用了环境变量</strong> → 开机时 $TOKEN、$PORT 为空 3. <strong>boot 脚本语法错误</strong> → 检查日志：<code>logcat -s termux:boot</code></p><h3 level=\"3\" id=\"Q5-进程崩溃后没自动重启\">Q5: 进程崩溃后没自动重启？</h3><p>可能原因： 1. <strong>crond 没运行</strong> → <code>ps aux | grep crond</code> 2. <strong>monitor.sh 路径错误</strong> → crontab 里用绝对路径 <code>/data/data/com.termux/files/home/monitor.sh</code> 3. <strong>monitor.sh 里用了 $PREFIX</strong> → 改成绝对路径</p><h3 level=\"3\" id=\"Q6-如何调整检测频率\">Q6: 如何调整检测频率？</h3><p>编辑 crontab：</p><div class=\"llt-code readonly\"><div class=\"language\">auto</div><div class=\"wrapper\"><pre><code></code></pre></div></div><ul><li><p>每1分钟：<code>* * * * * /data/data/com.termux/files/home/monitor.sh</code></p></li><li><p>每5分钟：<code>*/5 * * * * /data/data/com.termux/files/home/monitor.sh</code></p></li><li><p>每10分钟：<code>*/10 * * * * /data/data/com.termux/files/home/monitor.sh</code></p></li></ul><h3 level=\"3\" id=\"Q7-boot-脚本执行了但进程没起来\">Q7: boot 脚本执行了但进程没起来？</h3><p>调试方法：</p><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-comment\" class=\"hljs-comment\"># 手动执行 boot 脚本看报错</span>\nbash -x ~/.termux/boot/services.sh\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 查看 termux:boot 日志</span>\nlogcat -s termux:boot\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 检查环境变量是否存在</span>\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">echo</span> <span class=\"hljs-variable\" class=\"hljs-variable\">$TOKEN</span> <span class=\"hljs-variable\" class=\"hljs-variable\">$PORT</span> <span class=\"hljs-variable\" class=\"hljs-variable\">$PREFIX</span>\n</code></pre></div></div><h3 level=\"3\" id=\"Q8-如何查看日志\">Q8: 如何查看日志？</h3><div class=\"llt-code readonly\"><div class=\"language\">bash</div><div class=\"wrapper\"><pre><code><span class=\"hljs-comment\" class=\"hljs-comment\"># 查看监控日志（进程重启记录）</span>\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">tail</span> -f ~/monitor.log\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 查看启动日志</span>\n<span class=\"hljs-built_in\" class=\"hljs-built_in\">tail</span> -f ~/boot.log\n\n<span class=\"hljs-comment\" class=\"hljs-comment\"># 查看 tmux 会话日志</span>\ntmux attach -t openclaw\ntmux attach -t frpc\n</code></pre></div></div><hr><h2 level=\"2\" id=\"效果\">效果</h2><ul><li><p><strong>手机重启</strong> → crond + frpc + OpenClaw <strong>全部自动启动</strong></p></li><li><p><strong>进程崩溃</strong> → 5分钟内自动检测并重启</p></li><li><p><strong>随时查看日志</strong> → <code>tmux attach -t openclaw</code></p></li></ul><hr><h2 level=\"2\" id=\"完整启动链路手机开机后\">完整启动链路（手机开机后）</h2><div class=\"llt-code readonly\"><div class=\"language\">csharp</div><div class=\"wrapper\"><pre><code>手机开机\n    ↓\ntermux:boot 自动触发\n    ↓\nservices.sh 执行：\n  <span class=\"hljs-number\" class=\"hljs-number\">1.</span> crond（关键！进程监控依赖它）\n  <span class=\"hljs-number\" class=\"hljs-number\">2.</span> frpc-start.sh（持有 wake <span class=\"hljs-keyword\" class=\"hljs-keyword\">lock</span>）\n  <span class=\"hljs-number\" class=\"hljs-number\">3.</span> OpenClaw（主服务）\n    ↓\nfrpc 持有 termux-wake-<span class=\"hljs-keyword\" class=\"hljs-keyword\">lock</span>，防止系统休眠\n    ↓\ncrond 每<span class=\"hljs-number\" class=\"hljs-number\">5</span>分钟运行 monitor.sh\n    ↓\n检测到进程挂了 → 自动重启\n</code></pre></div></div><hr><h2 level=\"2\" id=\"参考资源\">参考资源</h2><ul><li><p><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://wiki.termux.com/wiki/Termux:Boot\">Termux Wiki - Boot</a></p></li><li><p><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://wiki.termux.com/wiki/Cron\">Termux Wiki - Cron</a></p></li><li><p><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://tmuxcheatsheet.com/\">Tmux 常用命令</a></p></li></ul><script type=\"module\">const injectHtml = (root, html) => {\n  const iframe = document.createElement(\"iframe\");\n  const htmlContent = `<html><head></head><body>${html}</body></html>`;\n  iframe.style.width = \"100%\";\n  iframe.style.height = \"100%\";\n  iframe.onload = () => {\n    const doc = iframe.contentDocument || iframe.contentWindow?.document;\n    if (!doc) {\n      return;\n    }\n    doc.open();\n    doc.write(htmlContent);\n    doc.close();\n  };\n  root.replaceChildren(iframe);\n}\n  document.querySelectorAll('.playground')?.forEach(el=>{\n    const html = el.getAttribute('data-html');\n    if (html) {\n      injectHtml(el,html);\n    }\n    const indicator = document.createElement(\"div\");\n    indicator.className = \"indicator\";\n    const showCode = document.createElement(\"div\");\n    showCode.className = \"show-code\";\n    showCode.innerText = \"code\";\n    showCode.onclick = () => {\n      el.parentElement.classList.remove(\"preview-only\");\n    };\n    const showPreview = document.createElement(\"div\");\n    showPreview.className = \"show-preview\";\n    showPreview.innerText = \"preview\";\n    showPreview.onclick = () => {\n      el.parentElement.classList.add(\"preview-only\");\n    };\n    indicator.appendChild(showCode);\n    indicator.appendChild(showPreview);\n    el.parentElement.appendChild(indicator);\n    if (window.screen.width < 768) {\n      showPreview.click();\n    }\n  });</script>","id":"how-to-keep-openclaw-and-frpc-on","path":"/posts/how-to-keep-openclaw-and-frpc-on.json"}